<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Planilla Quincenal</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <style>
    .table th, .table td {
      font-size: 0.85rem;
      vertical-align: middle;
    }
    .input-sm {
      font-size: 0.8rem;
      padding: 2px 6px;
    }
  </style>
</head>
<body class="bg-light">
<div class="container py-4">

  <h4 class="mb-3">
    Planilla de Asistencia - <span th:text="${persona.nombre + ' ' + persona.apellido}"></span>
  </h4>

  <!-- Selector de quincena -->
  <form th:action="@{/asistencia/planilla}" method="get" class="d-flex align-items-center mb-4">
    <input type="hidden" name="personaId" th:value="${persona.id}" />
    <label class="me-2">Seleccionar quincena:</label>
    <select name="quincena" class="form-select w-auto" required>
      <option th:each="quincena : ${quincenas}" 
              th:value="${quincena.inicio + '_' + quincena.fin}" 
              th:text="${#dates.format(quincena.inicio, 'dd/MM/yyyy')} + ' al ' + ${#dates.format(quincena.fin, 'dd/MM/yyyy')}"
              th:selected="${quincenaSeleccionada == quincena}">
      </option>
    </select>
    <button type="submit" class="btn btn-primary ms-2">Cargar</button>
  </form>

  <!-- Planilla tipo Excel -->
  <form th:action="@{/asistencia/guardar-planilla}" method="post">
    <input type="hidden" name="personaId" th:value="${persona.id}" />
    <input type="hidden" name="quincenaInicio" th:value="${quincenaSeleccionada.inicio}" />
    <table class="table table-bordered table-sm">
      <thead class="table-dark text-center">
        <tr>
          <th>Fecha</th>
          <th>Entrada</th>
          <th>Salida</th>
          <th>Almuerzo</th>
          <th>Tiempo Trabajado</th>
          <th>Día</th>
          <th>Excepción</th>
          <th>Horas Día</th>
          <th>Aus. Just.</th>
          <th>Aus. No Just.</th>
          <th>Presentismo</th>
          <th>50%</th>
          <th>100%</th>
          <th>Vianda</th>
          <th>Acuerdo</th>
          <th>Premio</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="registro, i : ${registros}">
          <td th:text="${#dates.format(registro.fecha, 'EEEE, dd/MM/yyyy')}"></td>
          <td><input type="time" class="form-control input-sm" name="entrada" th:name="'registros['+i+'].entrada'" th:value="${registro.entrada}" /></td>
          <td><input type="time" class="form-control input-sm" name="salida" th:name="'registros['+i+'].salida'" th:value="${registro.salida}" /></td>
          <td><input type="text" class="form-control input-sm" th:name="'registros['+i+'].almuerzo'" th:value="${registro.almuerzo}" /></td>
          <td><input type="text" class="form-control input-sm" th:name="'registros['+i+'].tiempoTrabajado'" th:value="${registro.tiempoTrabajado}" /></td>
          <td><input type="number" min="0" max="1" class="form-control input-sm" th:name="'registros['+i+'].diasTrabajados'" th:value="${registro.diasTrabajados}" /></td>
          <td><input type="text" class="form-control input-sm" th:name="'registros['+i+'].observacion'" th:value="${registro.observacion}" /></td>
          <td><input type="number" class="form-control input-sm" th:name="'registros['+i+'].horasPorDia'" th:value="${registro.horasPorDia}" /></td>
          <td><input type="number" class="form-control input-sm" th:name="'registros['+i+'].ausenciasJustificadas'" th:value="${registro.ausenciasJustificadas}" /></td>
          <td><input type="number" class="form-control input-sm" th:name="'registros['+i+'].ausenciasNoJustificadas'" th:value="${registro.ausenciasNoJustificadas}" /></td>
          <td><input type="checkbox" th:name="'registros['+i+'].presentismo'" th:checked="${registro.presentismo}" /></td>
          <td><input type="number" class="form-control input-sm" th:name="'registros['+i+'].horasAl50'" th:value="${registro.horasAl50}" /></td>
          <td><input type="number" class="form-control input-sm" th:name="'registros['+i+'].horasAl100'" th:value="${registro.horasAl100}" /></td>
          <td><input type="checkbox" th:name="'registros['+i+'].vianda'" th:checked="${registro.vianda}" /></td>
          <td><input type="checkbox" th:name="'registros['+i+'].acuerdo'" th:checked="${registro.acuerdo}" /></td>
          <td><input type="checkbox" th:name="'registros['+i+'].premio'" th:checked="${registro.premio}" /></td>
        </tr>
      </tbody>
    </table>
    <button type="submit" class="btn btn-success">Guardar Quincena</button>
  </form>
</div>
</body>
</html>