<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro Quincenal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f9fafb;
      font-family: 'Inter', sans-serif;
    }

    h4 {
      font-weight: 600;
      color: #111827;
    }

    .table-wrapper {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      background: white;
    }

    .table thead {
      background-color: #1f2937;
      color: white;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .table th, .table td {
      vertical-align: middle;
      font-size: 0.875rem;
      padding: 0.6rem;
      border-color: #e5e7eb;
    }

    .form-control,
    .form-select {
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .form-check-input {
      width: 1.1rem;
      height: 1.1rem;
    }

    .btn-success {
      border-radius: 8px;
      font-weight: 500;
    }

    .fin-semana {
      background-color: #f3f4f6 !important;
    }

    .feriado {
      background-color: #ffe4e6 !important;
    }

    .table tbody tr:hover {
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>

<div class="container py-5">
  <h4 class="mb-4">üìã Registro de Quincena de 
    <span th:text="${persona.nombre + ' ' + persona.apellido}"></span>
  </h4>

  <!-- Filtros -->
  <form method="get" th:action="@{/planilla}" class="row g-3 mb-4 align-items-end">
    <input type="hidden" name="personaId" th:value="${persona.id}" />
    <div class="col-md-4">
      <label class="form-label">Mes</label>
      <input type="month" class="form-control" name="mesSeleccionado" th:value="${mesSeleccionado}" required />
    </div>
    <div class="col-md-4">
      <label class="form-label">Quincena</label>
      <select class="form-select" name="quincena">
        <option value="1" th:selected="${quincena == 1}">1 al 15</option>
        <option value="2" th:selected="${quincena == 2}">16 al fin de mes</option>
      </select>
    </div>
    <div class="col-md-4">
      <button type="submit" class="btn btn-primary w-100">üîç Filtrar</button>
    </div>
  </form>

  <!-- Tabla -->
  <form th:action="@{/planilla}" method="post">
    <input type="hidden" name="personaId" th:value="${persona.id}" />
    <input type="hidden" name="quincena" th:value="${quincena}" />
    <input type="hidden" name="mesSeleccionado" th:value="${mesSeleccionado}" />

    <div class="table-responsive table-wrapper">
      <table class="table table-bordered table-sm align-middle text-center">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Entrada</th>
            <th>Salida</th>
            <th>Almuerzo</th>
            <th>Tiempo</th>
            <th>D√≠a</th>
            <th>Obs.</th>
            <th>Hs/D√≠a</th>
            <th>Just.</th>
            <th>No Just.</th>
            <th>Pres.</th>
            <th>50%</th>
            <th>100%</th>
            <th>Vianda</th>
            <th>Acuerdo</th>
            <th>Premio</th>
            <th>Inicio</th>
            <th>Fin</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="registro, i : ${registros}"
              th:classappend="(${registro.esFinDeSemana} ? 'fin-semana ' : '') + (${registro.feriado} ? 'feriado' : '')">
            <td th:text="${registro.fecha}"></td>

            <td><input type="time" class="form-control" th:name="'registros[' + ${i.index} + '].entrada'" th:value="${registro.entrada}" /></td>
            <td><input type="time" class="form-control" th:name="'registros[' + ${i.index} + '].salida'" th:value="${registro.salida}" /></td>
            <td><input type="time" class="form-control" th:name="'registros[' + ${i.index} + '].almuerzo'" th:value="${registro.almuerzo}" /></td>
            <td><input type="text" readonly class="form-control" th:name="'registros[' + ${i.index} + '].tiempoTrabajado'" th:value="${registro.tiempoTrabajado}" /></td>
            <td><input type="number" min="0" max="1" class="form-control" th:name="'registros[' + ${i.index} + '].diaTrabajado'" th:value="${registro.diaTrabajado}" /></td>
            <td><input type="text" class="form-control" th:name="'registros[' + ${i.index} + '].observacion'" th:value="${registro.observacion}" /></td>
            <td><input type="number" class="form-control" th:name="'registros[' + ${i.index} + '].horasPorDia'" th:value="${registro.horasPorDia}" /></td>
            <td><input type="number" class="form-control" th:name="'registros[' + ${i.index} + '].ausenciasJustificadas'" th:value="${registro.ausenciasJustificadas}" /></td>
            <td><input type="number" class="form-control" th:name="'registros[' + ${i.index} + '].ausenciasNoJustificadas'" th:value="${registro.ausenciasNoJustificadas}" /></td>
            <td><input type="checkbox" class="form-check-input" th:name="'registros[' + ${i.index} + '].presentismo'" th:checked="${registro.presentismo}" /></td>
            <td><input type="number" class="form-control" th:name="'registros[' + ${i.index} + '].horasAl50'" th:value="${registro.horasAl50}" /></td>
            <td><input type="number" class="form-control" th:name="'registros[' + ${i.index} + '].horasAl100'" th:value="${registro.horasAl100}" /></td>
            <td><input type="checkbox" class="form-check-input" th:name="'registros[' + ${i.index} + '].vianda'" th:checked="${registro.vianda}" /></td>
            <td><input type="checkbox" class="form-check-input" th:name="'registros[' + ${i.index} + '].acuerdo'" th:checked="${registro.acuerdo}" /></td>
            <td><input type="checkbox" class="form-check-input" th:name="'registros[' + ${i.index} + '].premio'" th:checked="${registro.premio}" /></td>
            <td><input type="time" class="form-control" th:name="'registros[' + ${i.index} + '].jornadaInicio'" th:value="${registro.jornadaInicio}" /></td>
            <td><input type="time" class="form-control" th:name="'registros[' + ${i.index} + '].jornadaFin'" th:value="${registro.jornadaFin}" /></td>

            <!-- Ocultos -->
            <input type="hidden" th:name="'registros[' + ${i.index} + '].fecha'" th:value="${registro.fecha}" />
            <input type="hidden" th:name="'registros[' + ${i.index} + '].persona.id'" th:value="${registro.persona.id}" />
            <input type="hidden" th:name="'registros[' + ${i.index} + '].id'" th:value="${registro.id}" />
          </tr>
        </tbody>
      </table>
    </div>

    <div class="text-end mt-4">
      <button type="submit" class="btn btn-success px-4 py-2">
        üíæ Guardar Quincena
      </button>
    </div>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</body>
</html>